<!DOCTYPE html>
<html>
<head>
  <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
  <meta charset="utf-8">
  <meta name="description" content="图片懒加载"/>
  <title>进阶16-懒加载</title>
  <style>
    .wrap{
      width: 400px;
      margin: 10px auto;
      //border: 1px solid;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    img{
      width: 150px;
      height:150px;
      margin: 10px;
      //border: 1px solid;
    }
    /*占位 展示懒加载效果*/
    .box{
      width: 150px;
      height:150px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-0b4941b86f9e4ca3.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/559" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-d32c567a6fbdd23e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
    <img src="https://upload-images.jianshu.io/upload_images/6426975-ce1f45e549a5502a.gif?imageMogr2/auto-orient/" data-src="https://upload-images.jianshu.io/upload_images/6426975-bdb2699286dbeb18.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/700" alt="">
  </div>
  <div class="box"></div>
  <script>
    var $window=$(window);
    var isShow=false;

    lazyRender()
    $window.on('scroll',function(){
      lazyRender()
    })

    function lazyRender(){
      $('.wrap img').each(function(){
        var $this=$(this)
        if( isVisible(($this)) && !isloaded($this) && !isShow){
          isShow=true;
          loadImg($this);
          //console.log('hhh')
        }
      })
    }

    function isVisible($node){
      var windowHeight=$window.height();
      var scrollTop=$window.scrollTop();
      var offsetTop=$node.offset().top;
      if( offsetTop+200<windowHeight+scrollTop && offsetTop>scrollTop ){
        return true;
      }else{
        return false;
      }
    }

    function isloaded($node){
      if($node.attr('src')===$node.attr('data-src')){
        return true
      }else{
        isShow=false;
        return false;
      }
    }

    function loadImg($node){
      var $dataSrc=$node.attr('data-src');
      $node.attr('src',$dataSrc);
    } 
  </script>
</body>
</html>
